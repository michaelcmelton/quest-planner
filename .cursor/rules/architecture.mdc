---
description: 
globs: 
alwaysApply: true
---
# Architecture Guidelines

## Project Structure
- pattern: "src/**/*"
  rules:
    - name: "SvelteKit Routing"
      pattern: "src/routes/(?!\\+layout\\.svelte|api/).*\\.svelte"
      message: "Follow SvelteKit's file-based routing conventions"
      severity: error
    - name: "Shared Components"
      pattern: "src/(?!lib/).*/components/.*\\.svelte"
      message: "Keep shared components in src/lib directory"
      severity: error
    - name: "TypeScript Usage"
      pattern: "\\.js$"
      message: "Use TypeScript for type safety"
      severity: error

## Component Design
- pattern: "**/*.svelte"
  rules:
    - name: "Component Size"
      pattern: "^.{500,}$"
      message: "Keep components small and focused (under 500 lines)"
      severity: warning
    - name: "Props Usage"
      pattern: "let\\s+\\w+\\s*=\\s*\\w+"
      message: "Use props for configuration instead of hardcoded values"
      severity: warning
    - name: "Slot Usage"
      pattern: "<div>.*</div>"
      message: "Consider using slots for component composition"
      severity: warning

## State Management
- pattern: "src/lib/stores/**/*"
  rules:
    - name: "Store Location"
      pattern: "src/(?!lib/stores).*/store\\.ts"
      message: "Keep stores in src/lib/stores directory"
      severity: error
    - name: "Store Types"
      pattern: "writable\\([^)]*\\)"
      message: "Define proper types for store values"
      severity: error
    - name: "Store Exports"
      pattern: "export\\s+const\\s+\\w+\\s*="
      message: "Export stores through index.ts files for cleaner imports"
      severity: warning

## Data Flow
- pattern: "src/routes/**/*"
  rules:
    - name: "Load Function"
      pattern: "export\\s+async\\s+function\\s+load"
      message: "Use SvelteKit's load functions for data fetching"
      severity: warning
    - name: "Data Validation"
      pattern: "data\\s*=\\s*\\w+"
      message: "Implement proper data validation"
      severity: warning
    - name: "Error Handling"
      pattern: "throw\\s+new\\s+Error"
      message: "Handle loading and error states properly"
      severity: error

## API Design
- pattern: "src/routes/api/**/*"
  rules:
    - name: "API Versioning"
      pattern: "src/routes/api/(?!v\\d+/).*"
      message: "Version APIs appropriately (e.g., /api/v1/...)"
      severity: warning
    - name: "Error Handling"
      pattern: "throw\\s+new\\s+Error"
      message: "Handle API errors consistently"
      severity: error
    - name: "Response Format"
      pattern: "return\\s+new\\s+Response\\([^)]*\\)"
      message: "Use consistent response formats"
      severity: warning

## Performance
- pattern: "**/*.{ts,js,svelte}"
  rules:
    - name: "Code Splitting"
      pattern: "import\\s+.*\\s+from\\s+'.*'"
      message: "Consider using dynamic imports for code splitting"
      severity: warning
    - name: "Asset Optimization"
      pattern: "src=\".*\\.(jpg|png|gif)\""
      message: "Optimize images and other assets"
      severity: warning
    - name: "SSR Usage"
      pattern: "export\\s+const\\s+ssr\\s*=\\s*false"
      message: "Use SvelteKit's server-side rendering capabilities"
      severity: warning

## Testing
- pattern: "**/*.{test,spec}.{ts,js}"
  rules:
    - name: "Test Coverage"
      pattern: "describe\\('.*',\\s*\\(\\)\\s*=>\\s*\\{\\s*\\}\\)"
      message: "Maintain high test coverage"
      severity: warning
    - name: "Error Testing"
      pattern: "expect\\(.*\\)\\.toThrow"
      message: "Test error cases and edge conditions"
      severity: warning
    - name: "Test Organization"
      pattern: "test\\('.*',\\s*\\(\\)\\s*=>\\s*\\{\\s*\\}\\)"
      message: "Organize tests properly with describe blocks"
      severity: warning
